mutation CreateControlGroup($name: String!, $adminGroupId: Int!) {
  controlGroup: insert_control_group_one(object: { name: $name, admin_group_id: $adminGroupId }) {
    ...ControlGroupFields
  }
}

mutation AddDevice($objects: [control_group_device_insert_input!]!) {
  response: insert_control_group_device(objects: $objects) {
    affectedRows: affected_rows
  }
}

mutation RemoveDevice($controlGroupId: Int!, $serialNos: [Int!]!) {
  response: delete_control_group_device(
    where: { control_group_id: { _eq: $controlGroupId }, serialno: { _in: $serialNos } }
  ) {
    affectedRows: affected_rows
  }
}

query ControlGroup($id: Int!) {
  controlGroup: control_group_by_pk(id: $id) {
    ...ControlGroupFields
  }
}

query ControlGroupDevices($controlGroupId: Int!) {
  controlGroupDevices: control_group_by_pk(id: $controlGroupId) {
    devices {
      zappi: control_group_device_zappi {
        ...ZappiData
      }
      eddi: control_group_device_eddi {
        ...EddiData
      }
    }
  }
}

query ControlGroupStatus($controlGroupId: Int!) {
  controlGroupStatus: control_group_by_pk(id: $controlGroupId) {
    devices {
      eddi: control_group_device_eddi {
        ...EddiStatus
      }
      zappi: control_group_device_zappi {
        ...ZappiStatus
      }
    }
  }
}

query ControlGroupHistory($controlGroupId: Int!) {
  controlGroupHistory: control_group_by_pk(id: $controlGroupId) {
    devices {
      eddiMinutes: control_group_history_eddi {
        ...EddiHistory
      }
      zappiMinutes: control_group_history_zappi {
        ...ZappiHistory
      }
    }
  }
}

query ControlGroups($limit: Int, $offset: Int) {
  controlGroups: control_group(limit: $limit, offset: $offset) {
    ...ControlGroupFields
  }
}

fragment ControlGroupFields on control_group {
  id
  name
}
